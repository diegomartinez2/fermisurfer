%% Generated by Sphinx.
\def\sphinxdocclass{ujbook}
\documentclass[letterpaper,10pt,dvipdfmx,openany]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}


\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}




\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}




\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage[dvipdfm]{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}
\usepackage{pxjahyper}


\usepackage{sphinxmessages}
\setcounter{tocdepth}{2}

\usepackage{pxjahyper}

\title{Fermisurfer Documentation}
\date{2023年08月18日}
\release{2.4.0}
\author{kawamura}
\newcommand{\sphinxlogo}{\sphinxincludegraphics{fermisurfer.png}\par}
\renewcommand{\releasename}{リリース}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxstepscope


\chapter{はじめに}
\label{\detokenize{overview:id1}}\label{\detokenize{overview::doc}}
\sphinxAtStartPar
この文書ではFermi面描画ソフト「Fermi Surfer」についての解説を行っています.
Fermi Surferは東京大学の河村光晶が2012年頃から開発を行っていたもので,
2014年11月に公開されました.
Fermi面を描画しその上に各種物理量(超伝導ギャップ関数や軌道キャラクターなど)
をカラープロットするソフトウェアです.

\sphinxstepscope


\chapter{ディレクトリと主なファイル}
\label{\detokenize{file:id1}}\label{\detokenize{file::doc}}\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{doc/}}}{[}マニュアルのディレクトリ{]}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{doc/index.html}} : 目次ページ

\end{itemize}

\end{description}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{examples/}} : サンプル入力ファイル

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{src/}} : ソースファイルのディレクトリ

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{configure}} : ビルド設定スクリプト

\end{itemize}

\sphinxstepscope


\chapter{インストール手順}
\label{\detokenize{install:id1}}\label{\detokenize{install::doc}}

\section{Linux, macOSの場合}
\label{\detokenize{install:linux-macos}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
必要なパッケージをインストール(既にパッケージが入っている場合は何も起こりません.)
\begin{itemize}
\item {} 
\sphinxAtStartPar
Debian/Ubuntu 等

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }sudo\PYG{+w}{ }aptitude\PYG{+w}{ }install\PYG{+w}{ }libwxgtk3.0\PYGZhy{}dev
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
Red Hat Enterprise Linux/CentOS 等

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }sudo\PYG{+w}{ }yum\PYG{+w}{ }install\PYG{+w}{ }wxGTK3\PYGZhy{}devel.x86\PYGZus{}64
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
macOS (Homebrew)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }brew\PYG{+w}{ }install\PYG{+w}{ }wxmac
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
macOS (Mac Ports)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }port\PYG{+w}{ }install\PYG{+w}{ }wxWidgets\PYGZhy{}3.0
\end{sphinxVerbatim}

\end{itemize}

\item {} 
\sphinxAtStartPar
インストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }./configure
\PYGZdl{}\PYG{+w}{ }make
\PYGZdl{}\PYG{+w}{ }sudo\PYG{+w}{ }make\PYG{+w}{ }install
\end{sphinxVerbatim}

\end{enumerate}

\sphinxAtStartPar
以上で実行可能ファイル \sphinxcode{\sphinxupquote{src/fermisurfer}} が作られ,
\sphinxcode{\sphinxupquote{/usr/local/bin/}} にコピーされます.


\section{Windowsの場合}
\label{\detokenize{install:windows}}
\sphinxAtStartPar
バイナリ実行ファイルをダウンロードする.

\sphinxAtStartPar
またwxWidgetsライブラリをインストールしたのちにFermiSurferを自前でビルドすることも可能.
VisualStudio用ファイル \sphinxcode{\sphinxupquote{fermisurfer.vcxproj}} が利用できる.

\sphinxstepscope


\chapter{Input file}
\label{\detokenize{input:input-file}}\label{\detokenize{input:input}}\label{\detokenize{input::doc}}

\section{input fileの書式}
\label{\detokenize{input:id1}}
\sphinxAtStartPar
用意するデータは,
\begin{itemize}
\item {} 
\sphinxAtStartPar
Brillouin領域分割数(3方向)

\item {} 
\sphinxAtStartPar
逆格子ベクトル

\item {} 
\sphinxAtStartPar
バンド本数

\item {} 
\sphinxAtStartPar
軌道固有値(以下エネルギーと呼びます)の各バンド,  \(k\) グリッド点での値

\item {} 
\sphinxAtStartPar
カラープロットしたい物理量(以下物理量と呼びます)の各バンド,
\(k\) グリッド点での値

\end{itemize}

\sphinxAtStartPar
です.

\sphinxAtStartPar
上記データを次のとおりの書式で並べます(サンプルファイル
\sphinxcode{\sphinxupquote{mgb2\_vfz.frmsf}} の中身).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{l+m+mi}{40}          \PYG{l+m+mi}{40}          \PYG{l+m+mi}{36}        \PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{l+m+mi}{0}                                 \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{l+m+mi}{3}                                 \PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{l+m+mf}{1.0000000}      \PYG{l+m+mf}{0.57735026}      \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.0000000} \PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{l+m+mf}{0.0000000}       \PYG{l+m+mf}{1.1547005}       \PYG{l+m+mf}{0.0000000} \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{l+m+mf}{0.0000000}      \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.0000000}      \PYG{l+m+mf}{0.87206507} \PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{)}
\PYG{l+m+mf}{2.91340202E\PYGZhy{}02}                            \PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{)}
\PYG{l+m+mf}{2.93242838E\PYGZhy{}02}
\PYG{l+m+mf}{2.98905596E\PYGZhy{}02}
\PYG{l+m+mf}{3.08193434E\PYGZhy{}02}
\PYG{p}{:}
\PYG{p}{:}
\PYG{l+m+mf}{0.14393796}
\PYG{l+m+mf}{0.12800488}
\PYG{l+m+mf}{0.0000000}                                 \PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{)}
\PYG{l+m+mf}{0.36269817}
\PYG{l+m+mf}{0.71675694}
\PYG{l+m+mf}{1.0535113}
\PYG{l+m+mf}{1.3644149}
\PYG{p}{:}
\PYG{p}{:}
\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{26.409407}
\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{19.318560}
\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{10.315671}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
\(k\) グリッド数

\item {} 
\sphinxAtStartPar
\(k\) グリッドの指定方法( \sphinxcode{\sphinxupquote{0, 1, 2}} のいずれか)

\sphinxAtStartPar
\(k\) グリッドを次のように表します.
\begin{equation*}
\begin{split}\begin{align}
{\boldsymbol k}_{i,j,k} =
x_i {\boldsymbol b}_1 + y_j {\boldsymbol b}_2 + z_k {\boldsymbol b}_3
\end{align}\end{split}
\end{equation*}
\sphinxAtStartPar
ただし:math:\sphinxtitleref{i, j, k} は \(1\) から各逆格子ベクトル方向の分割数
\(N_1, N_2, N_3\) (上で読み取ったもの)とする

\sphinxAtStartPar
\(x_i, y_j,z_k\) は次の3つのとり方が可能です.
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{0}} の場合(Monkhorst\sphinxhyphen{}Packグリッド) :
\(x_i = \frac{2 i - 1 - N_1}{2 N_1}\)

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{1}} の場合 : \(x_i = \frac{i - 1}{N_1}\)

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{2}} の場合 : \(x_i = \frac{2 i - 1}{2 N_1}\)

\end{itemize}

\item {} 
\sphinxAtStartPar
バンド本数

\item {} 
\sphinxAtStartPar
逆格子ベクトル1 (任意単位)

\item {} 
\sphinxAtStartPar
逆格子ベクトル2

\item {} 
\sphinxAtStartPar
逆格子ベクトル3

\item {} 
\sphinxAtStartPar
エネルギー (並び順は {\hyperref[\detokenize{input:format}]{\sphinxcrossref{\DUrole{std,std-ref}{C/fortranでの入力ファイルの書き出し方}}}} 参照)

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{fermisurfer}} はデフォルトではFermiエネルギーを
\sphinxcode{\sphinxupquote{0.0}} としています. ただし,
後述の \sphinxcode{\sphinxupquote{Shift Fermi Energy}} メニューを用いて
Fermiエネルギーを \sphinxcode{\sphinxupquote{0.0}} 以外の値に変更することも可能です.

\item {} 
\sphinxAtStartPar
物理量 (並び順は {\hyperref[\detokenize{input:format}]{\sphinxcrossref{\DUrole{std,std-ref}{C/fortranでの入力ファイルの書き出し方}}}} 参照) (オプショナル)

\sphinxAtStartPar
0個から3個のブロックで, カラープロットしたい量を入力する.
省略することも可能.

\end{enumerate}


\section{BXSF形式}
\label{\detokenize{input:bxsf}}
\sphinxAtStartPar
XCrysDen用の入力ファイルを \sphinxcode{\sphinxupquote{fermisurfer}} で読み取ることも可能.
その場合は前節の「物理量」を省略した場合と同じ振る舞いになる。


\section{C/fortranでの入力ファイルの書き出し方}
\label{\detokenize{input:c-fortran}}\label{\detokenize{input:format}}
\sphinxAtStartPar
fortran

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{bvec1}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec2}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec3}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!逆格子ベクトル}
\PYG{k+kt}{INTEGER}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}\PYG{+w}{ }\PYG{c}{!各逆格子ベクトルの方向の分割数}
\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ishift}\PYG{+w}{ }\PYG{c}{!グリットをシフトさせるか(=1)否か(=0)}
\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nbnd}\PYG{+w}{ }\PYG{c}{!バンド数}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{eig}\PYG{p}{(}\PYG{n}{nk3}\PYG{p}{,}\PYG{n}{nk2}\PYG{p}{,}\PYG{n}{nk1}\PYG{p}{,}\PYG{n}{nbnd}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!エネルギー}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{x}\PYG{p}{(}\PYG{n}{nk3}\PYG{p}{,}\PYG{n}{nk2}\PYG{p}{,}\PYG{n}{nk1}\PYG{p}{,}\PYG{n}{nbnd}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!物理量}

\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ik1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik3}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ibnd}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{fo}

\PYG{k}{open}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{file}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}sample.frmsf\PYGZdq{}}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{ishift}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec1}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec2}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec3}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{do }\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{+w}{   }\PYG{k}{do }\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk1}
\PYG{+w}{      }\PYG{k}{do }\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}
\PYG{+w}{         }\PYG{k}{do }\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{+w}{            }\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{eig}\PYG{p}{(}\PYG{n}{ik3}\PYG{p}{,}\PYG{n}{ik2}\PYG{p}{,}\PYG{n}{ik1}\PYG{p}{,}\PYG{n}{ibnd}\PYG{p}{)}\PYG{p}{)}
\PYG{+w}{         }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{      }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{   }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{end }\PYG{k}{do}
\PYG{k}{do }\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{+w}{   }\PYG{k}{do }\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk1}
\PYG{+w}{      }\PYG{k}{do }\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}
\PYG{+w}{         }\PYG{k}{do }\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{+w}{            }\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{x}\PYG{p}{(}\PYG{n}{ik3}\PYG{p}{,}\PYG{n}{ik2}\PYG{p}{,}\PYG{n}{ik1}\PYG{p}{,}\PYG{n}{ibnd}\PYG{p}{)}\PYG{p}{)}
\PYG{+w}{         }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{      }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{   }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{end }\PYG{k}{do}
\PYG{k}{close}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
C言語

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{bvec1}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec2}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec3}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{ }\PYG{c+cm}{/*逆格子ベクトル*/}
\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}\PYG{p}{;}\PYG{+w}{ }\PYG{c+cm}{/*各逆格子ベクトルの方向の分割数*/}
\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{ishift}\PYG{p}{;}\PYG{+w}{ }\PYG{c+cm}{/*グリットをシフトさせるか(=1)否か(=0)*/}
\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{nbnd}\PYG{p}{;}\PYG{+w}{ }\PYG{c+cm}{/*バンド数*/}
\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{eig}\PYG{p}{[}\PYG{n}{nbnd}\PYG{p}{]}\PYG{p}{[}\PYG{n}{nk1}\PYG{p}{]}\PYG{p}{[}\PYG{n}{nk2}\PYG{p}{]}\PYG{p}{[}\PYG{n}{nk3}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{ }\PYG{c+cm}{/*エネルギー*/}
\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{x}\PYG{p}{[}\PYG{n}{nbnd}\PYG{p}{]}\PYG{p}{[}\PYG{n}{nk1}\PYG{p}{]}\PYG{p}{[}\PYG{n}{nk2}\PYG{p}{]}\PYG{p}{[}\PYG{n}{nk3}\PYG{p}{]}\PYG{p}{;}\PYG{+w}{ }\PYG{c+cm}{/*物理量*/}

\PYG{k+kt}{FILE}\PYG{o}{*}\PYG{+w}{ }\PYG{n}{fo}\PYG{p}{;}
\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{ibnd}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik3}\PYG{p}{;}

\PYG{n}{fo}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fopen}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{sample.frmsf}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{w}\PYG{l+s}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}d \PYGZpc{}d \PYGZpc{}d}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}d}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{iswitch}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}d}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nbnd}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}e \PYGZpc{}e \PYGZpc{}e}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec1}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec1}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec1}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}e \PYGZpc{}e \PYGZpc{}e}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec2}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec2}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec2}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}e \PYGZpc{}e \PYGZpc{}e}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec3}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec3}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec3}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nbnd}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ibnd}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{   }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ik1}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{      }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ik2}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{         }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nk3}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ik3}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}e}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{eig}\PYG{p}{[}\PYG{n}{ibnd}\PYG{p}{]}\PYG{p}{[}\PYG{n}{ik1}\PYG{p}{]}\PYG{p}{[}\PYG{n}{ik2}\PYG{p}{]}\PYG{p}{[}\PYG{n}{ik3}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{         }\PYG{p}{\PYGZcb{}}
\PYG{+w}{      }\PYG{p}{\PYGZcb{}}
\PYG{+w}{   }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nbnd}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ibnd}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{   }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ik1}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{      }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ik2}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{         }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{nk3}\PYG{p}{;}\PYG{+w}{ }\PYG{o}{+}\PYG{o}{+}\PYG{n}{ik3}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{ierr}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{fprintf}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZpc{}e}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{x}\PYG{p}{[}\PYG{n}{ibnd}\PYG{p}{]}\PYG{p}{[}\PYG{n}{ik1}\PYG{p}{]}\PYG{p}{[}\PYG{n}{ik2}\PYG{p}{]}\PYG{p}{[}\PYG{n}{ik3}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
\PYG{+w}{         }\PYG{p}{\PYGZcb{}}
\PYG{+w}{      }\PYG{p}{\PYGZcb{}}
\PYG{+w}{   }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\PYG{n}{fclose}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\section{2次元量のカラープロットを行う場合}
\label{\detokenize{input:id2}}
\sphinxAtStartPar
fortran

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{bvec1}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec2}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec3}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!逆格子ベクトル}
\PYG{k+kt}{INTEGER}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}\PYG{+w}{ }\PYG{c}{!各逆格子ベクトルの方向の分割数}
\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ishift}\PYG{+w}{ }\PYG{c}{!グリットをシフトさせるか(=1)否か(=0)}
\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nbnd}\PYG{+w}{ }\PYG{c}{!バンド数}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{eig}\PYG{p}{(}\PYG{n}{nk3}\PYG{p}{,}\PYG{n}{nk2}\PYG{p}{,}\PYG{n}{nk1}\PYG{p}{,}\PYG{n}{nbnd}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!エネルギー}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{x}\PYG{p}{(}\PYG{n}{nk3}\PYG{p}{,}\PYG{n}{nk2}\PYG{p}{,}\PYG{n}{nk1}\PYG{p}{,}\PYG{n}{nbnd}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!物理量 (2次元量、複素数など)}

\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ik1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik3}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ibnd}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ii}

\PYG{k}{open}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{file}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}sample.frmsf\PYGZdq{}}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{ishift}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec1}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec2}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec3}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{do }\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{+w}{   }\PYG{k}{do }\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk1}
\PYG{+w}{      }\PYG{k}{do }\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}
\PYG{+w}{         }\PYG{k}{do }\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{+w}{            }\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{eig}\PYG{p}{(}\PYG{n}{ik3}\PYG{p}{,}\PYG{n}{ik2}\PYG{p}{,}\PYG{n}{ik1}\PYG{p}{,}\PYG{n}{ibnd}\PYG{p}{)}\PYG{p}{)}
\PYG{+w}{         }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{      }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{   }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{end }\PYG{k}{do}
\PYG{k}{do }\PYG{n}{ii}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m+mi}{2}
\PYG{+w}{   }\PYG{k}{do }\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{+w}{      }\PYG{k}{do }\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk1}
\PYG{+w}{         }\PYG{k}{do }\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}
\PYG{+w}{            }\PYG{k}{do }\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{+w}{               }\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{x}\PYG{p}{(}\PYG{n}{ik3}\PYG{p}{,}\PYG{n}{ik2}\PYG{p}{,}\PYG{n}{ik1}\PYG{p}{,}\PYG{n}{ibnd}\PYG{p}{,}\PYG{n}{ii}\PYG{p}{)}\PYG{p}{)}
\PYG{+w}{            }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{         }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{      }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{   }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{close}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{)}
\end{sphinxVerbatim}


\section{カラープロットしたい量を省略する場合}
\label{\detokenize{input:id3}}
\sphinxAtStartPar
fortran

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{bvec1}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec2}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{bvec3}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!逆格子ベクトル}
\PYG{k+kt}{INTEGER}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}\PYG{+w}{ }\PYG{c}{!各逆格子ベクトルの方向の分割数}
\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ishift}\PYG{+w}{ }\PYG{c}{!グリットをシフトさせるか(=1)否か(=0)}
\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nbnd}\PYG{+w}{ }\PYG{c}{!バンド数}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{eig}\PYG{p}{(}\PYG{n}{nk3}\PYG{p}{,}\PYG{n}{nk2}\PYG{p}{,}\PYG{n}{nk1}\PYG{p}{,}\PYG{n}{nbnd}\PYG{p}{)}\PYG{+w}{ }\PYG{c}{!エネルギー}

\PYG{k+kt}{integer}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ik1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ik3}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ibnd}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ii}

\PYG{k}{open}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{file}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}sample.frmsf\PYGZdq{}}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{nk1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{ishift}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec1}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec2}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{bvec3}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{do }\PYG{n}{ibnd}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nbnd}
\PYG{+w}{   }\PYG{k}{do }\PYG{n}{ik1}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk1}
\PYG{+w}{      }\PYG{k}{do }\PYG{n}{ik2}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk2}
\PYG{+w}{         }\PYG{k}{do }\PYG{n}{ik3}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nk3}
\PYG{+w}{            }\PYG{k}{write}\PYG{p}{(}\PYG{n}{fo}\PYG{p}{,}\PYG{o}{*}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{eig}\PYG{p}{(}\PYG{n}{ik3}\PYG{p}{,}\PYG{n}{ik2}\PYG{p}{,}\PYG{n}{ik1}\PYG{p}{,}\PYG{n}{ibnd}\PYG{p}{)}\PYG{p}{)}
\PYG{+w}{         }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{      }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{   }\PYG{k}{end }\PYG{k}{do}
\PYG{k}{end }\PYG{k}{do}
\end{sphinxVerbatim}

\sphinxstepscope


\chapter{操作方法}
\label{\detokenize{ops:ops}}\label{\detokenize{ops:id1}}\label{\detokenize{ops::doc}}

\section{起動}
\label{\detokenize{ops:id2}}

\subsection{Linux・Unix・Macの場合}
\label{\detokenize{ops:linuxunixmac}}
\sphinxAtStartPar
作成した実行可能ファイル \sphinxcode{\sphinxupquote{fermisurfer}} にパスが通っている状態で

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }fermisurfer\PYG{+w}{ }mgb2\PYGZus{}vfz.frmsf
\end{sphinxVerbatim}

\sphinxAtStartPar
とコマンド, スペース, 入力ファイル名とタイプします.
(サンプルファイルの中身はMgB$_{\text{2}}$のFermi速度の \(z\) 方向成分です. )


\subsection{Windowsの場合}
\label{\detokenize{ops:windows}}
\sphinxAtStartPar
入力ファイル(この場合は \sphinxcode{\sphinxupquote{mgb2\_vfz.frmsf}})を右クリックし,
メニューから「プログラムから開く」を選択し,
実行ファイルを \sphinxcode{\sphinxupquote{fermisurfer.exe}} に設定してください.

\sphinxAtStartPar
次に操作方法が出力され, Fermi面が描画される(図 \ref{ops:startpng} ).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{start}.png}
\caption{Fermisurferを起動した直後の画面.}\label{\detokenize{ops:id23}}\label{\detokenize{ops:startpng}}\end{figure}
\begin{itemize}
\item {} 
\sphinxAtStartPar
マウスのドラッグによる回転が出来る.

\item {} 
\sphinxAtStartPar
マウスのホイールを使っての拡大・縮小が出来る.

\item {} 
\sphinxAtStartPar
ウィンドウの大きさを変えることもできる.

\item {} 
\sphinxAtStartPar
カーソルキー(Windowsではwasd)を使ってウィンドウ内で上下左右に図を動かせる.
ダブルクリックでも移動可。

\item {} 
\sphinxAtStartPar
右側のパネルを用いて様々な操作ができる.

\end{itemize}

\sphinxAtStartPar
次から右側のパネルでの操作をを説明する.

\begin{sphinxadmonition}{note}{注釈:}
\sphinxAtStartPar
いくつかの操作はすぐに反映されず「Update」ボタンを押すことによって反映される.
そのような操作については「要Update」と明記してある.
\end{sphinxadmonition}


\section{背景色}
\label{\detokenize{ops:id3}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Background (RGB)}} : 背景色をRGBで指定する.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{background}.png}
\end{figure}


\section{線幅}
\label{\detokenize{ops:id4}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Line width}} : ブリルアンゾーンの境界やノーダルライン等の線幅を変更する.


\section{線色}
\label{\detokenize{ops:id5}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Line color (RGB)}} : 線色をRGBで指定する.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{line_color}.png}
\end{figure}


\section{バンド毎の表示・非表示の切り替え}
\label{\detokenize{ops:id6}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Band 0, RGB}}, \sphinxcode{\sphinxupquote{Band 1, RGB}} ... : バンド毎の表示on/offを切り替える(図 \ref{ops:bandpng}).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{band}.png}
\caption{"Band" メニューで3番目のバンドの表示/非表示を切り替える.}\label{\detokenize{ops:id24}}\label{\detokenize{ops:bandpng}}\end{figure}


\section{Brillouin zoneの形式 (要Update)}
\label{\detokenize{ops:brillouin-zone-update}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Brillouin zone}} :
描画範囲をFirst Brillouin Zone/Primitive Brillouin Zoneと
切り替える事が出来ます (図 \ref{ops:brillouinzonepng}).
\begin{description}
\sphinxlineitem{Fisrst Brillouin Zone}
\sphinxAtStartPar
\({\rm \Gamma}\) 点から一番近いBragg面で囲まれた領域

\sphinxlineitem{Primitive Brillouine Zone}
\sphinxAtStartPar
逆格子ベクトルを辺とする平行6面体領域

\end{description}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{brillouinzone}.png}
\caption{"Brillouin zone" メニューでBrillouin領域のとり方を変更する.}\label{\detokenize{ops:id25}}\label{\detokenize{ops:brillouinzonepng}}\end{figure}


\section{Brillouin zoneの数 (要Update)}
\label{\detokenize{ops:id7}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{BZ number}} : 各逆格子ベクトルの方向にいくつ表示するかを指定する.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{bz_number}.png}
\end{figure}


\section{カラーバーの表示/非表示}
\label{\detokenize{ops:id8}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Color bar}} : カラーバーの表示/非表示を切り替えます(図 \ref{ops:colorbarpng}).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{colorbar}.png}
\caption{"Color bar On/Off" メニューでカラーバーの表示/非表示を切り替える.}\label{\detokenize{ops:id26}}\label{\detokenize{ops:colorbarpng}}\end{figure}


\section{カラープロットの種類と範囲 (要Update)}
\label{\detokenize{ops:update}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Color scale mode}} : Fermi面の色表示のさせ方を変更します(図 \ref{ops:colorscalepng}).
\begin{description}
\sphinxlineitem{Input (1D) (入力ファイルのデータが1個のときのデフォルト) :}
\sphinxAtStartPar
青\(\rightarrow\)緑\(\rightarrow\)赤の範囲でカラープロットする.

\sphinxlineitem{Input (2D) (入力ファイルのデータが2個のときのデフォルト) :}
\sphinxAtStartPar
カラーサークル(図参照)上の色でカラープロットする.

\sphinxlineitem{Input (3D) (入力ファイルのデータが3個のときのデフォルト) :}
\sphinxAtStartPar
フェルミ面上の矢印(細い三角形)としてプロットする.
フェルミ面の色は「Band Index」の場合と同様.

\sphinxlineitem{Fermi Velocity (入力ファイルのデータがエネルギーだけのときのデフォルト) :}
\sphinxAtStartPar
エネルギーの差分からFermi速度 \({\bf v}_{\rm F} = \nabla_k \varepsilon_k\)
を計算し, その絶対値をカラープロットする.

\sphinxlineitem{Band Index :}
\sphinxAtStartPar
物理量に関係なく, 各バンド毎に単色でFermi面を塗る.

\sphinxlineitem{Input (1D, Gray), Fermi Velocity (Gray)}
\sphinxAtStartPar
黒色の濃淡でプロットする.

\end{description}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Min of Scale}}, \sphinxcode{\sphinxupquote{Max of Scale}} : カラープロットの色の範囲を指定する.
「Input (3D)」の場合は \sphinxcode{\sphinxupquote{Max of Scale}} で三角形の長さを変更できる.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Arrow width}} : 「Input (3D)」の場合に矢印(三角形)の幅を指定する.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{colorscale}.png}
\caption{"Color scale mode" メニュー.}\label{\detokenize{ops:id27}}\label{\detokenize{ops:colorscalepng}}\end{figure}


\section{遠近法の有効化・無効化}
\label{\detokenize{ops:id9}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Perspective}} : 遠近法の有効化・無効化を切り替える.


\section{カラープロットの配色}
\label{\detokenize{ops:id10}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Bar Color}} :
カラープロットの配色を次の3つから選ぶことができる.
"BGR":青\(\rightarrow\)水\(\rightarrow\)緑\(\rightarrow\)黄\(\rightarrow\)赤、"CMY":水\(\rightarrow\)青\(\rightarrow\)桃\(\rightarrow\)赤\(\rightarrow\)黄、"MCY":桃\(\rightarrow\)青\(\rightarrow\)水\(\rightarrow\)緑\(\rightarrow\)黄.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{bar_color}.png}
\end{figure}


\section{Equator (要Update)}
\label{\detokenize{ops:equator-update}}
\sphinxAtStartPar
ある \({\bf k}\) に対して,
\({\bf v}_{\rm F} \cdot {\bf k} = 0\) となる線を表示, 変更する
(図 \ref{ops:equatorpng}).
作った時点では作者が勘違いしていたが、dHvAで考慮される極軌道(extremul orbit)とは一致しない。
超音波吸収とは関連すると考えられる。

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Equator}} : チェックボックスで表示・非表示を切り替える.
この時「Update」を押す必要はない.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Equator\sphinxhyphen{}v}} : このテキストボックスで \({\bf k}\) を指定する.
\({\bf k}\) ベクトルはフラクショナル座標で入力する.
変更を反映させるには「Update」を押す.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{equator}.png}
\caption{"Equator"メニューで Fermi面の極軌道(Equator)を表示する.}\label{\detokenize{ops:id28}}\label{\detokenize{ops:equatorpng}}\end{figure}


\section{補間の細かさ (要Update)}
\label{\detokenize{ops:id11}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Interpol ratio}} : 補間により図の曲面を滑らかにする (図 \ref{ops:interpolatepng}).
ただし分点数を増やすと描画にかかる時間も増えるので注意.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{interpolate}.png}
\caption{"Interpolate"メニューで 分点数を1から4に変える.}\label{\detokenize{ops:id29}}\label{\detokenize{ops:interpolatepng}}\end{figure}


\section{Fermi面のどちら側に光を当てるか}
\label{\detokenize{ops:fermi}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Lighting}} :
光を当てる面を変更します (図 \ref{ops:lightpng}).
\begin{description}
\sphinxlineitem{Both :}
\sphinxAtStartPar
Fermi面の表裏両面に光を当てます.

\sphinxlineitem{Unoccupy :}
\sphinxAtStartPar
非占有領域側のみに光を当てます.

\sphinxlineitem{Occupy :}
\sphinxAtStartPar
占有領域側のみに光を当てます.

\end{description}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{light}.png}
\caption{"Lighting"メニューで光を当てるFermi面を変更する.}\label{\detokenize{ops:id30}}\label{\detokenize{ops:lightpng}}\end{figure}


\section{マウスドラッグをしたときの振る舞い}
\label{\detokenize{ops:id12}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Mouse Drag}} :
マウスの左ボタンドラッグを行った時の動作を変更します.
\begin{description}
\sphinxlineitem{Rotate(デフォルト)}
\sphinxAtStartPar
ドラッグをした方向に図形を回転させます.

\sphinxlineitem{Scale}
\sphinxAtStartPar
上方にドラッグすると図形を拡大,
下方にドラッグすると図形を縮小します.

\sphinxlineitem{Translate}
\sphinxAtStartPar
ドラッグした方向に図形を動かします.

\end{description}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=200\sphinxpxdimen]{{mouce}.png}
\end{figure}


\section{ノーダルライン}
\label{\detokenize{ops:id13}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Nodal Line}} :
物理量が0となるところに引く線(ノーダルライン)のOn/Offを切り替えます(図 \ref{ops:nodelinepng}).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{nodeline}.png}
\caption{"Nodal line" メニューでnodal lineの表示/非表示を切り替える.}\label{\detokenize{ops:id31}}\label{\detokenize{ops:nodelinepng}}\end{figure}


\section{ブリルアンゾーンの断面 (要Update)}
\label{\detokenize{ops:id14}}
\sphinxAtStartPar
Brillouin領域を任意の断面で切り取り,
2次元のFermi面(線)を描画する (図 \ref{ops:sectionpng}).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Section}} : チェックボックスで断面の表示・非表示を切り替える
(この操作は「Update」の必要はない).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Section\sphinxhyphen{}v}} : 断面の法線の指定する.
法線ベクトルはフラクショナル座標で指定する。
変更を反映するには \sphinxcode{\sphinxupquote{Update}} を押す。

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{On Gamma}} : このチェックボックスがオンになっているときには
断面は \(\Gamma\) 点を通る.
変更を反映するには \sphinxcode{\sphinxupquote{Update}} を押す。

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Section (RGB)}} : ブリルアンゾーンの切断面を示す平面の色を指定する.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{section}.png}
\end{figure}


\section{ブリルアンゾーン断面のファイル出力}
\label{\detokenize{ops:id15}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Section file}} :
このボタンを押すと, 上記フェルミ面およびブリルアンゾーンの断面をGnuplotやIgolなどで図示するためのファイル("fermi\_line.dat"と"bz\_line.dat")
を出力する.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{section_file}.png}
\end{figure}

\sphinxAtStartPar
gnuplotでは次のように使うことができる.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{plot}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{fermi\PYGZus{}line.dat}\PYG{l+s}{\PYGZdq{}}\PYG{+w}{ }\PYG{n+nb}{w}\PYG{+w}{ }\PYG{n}{l}\PYG{o}{,}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{bz\PYGZus{}line.dat}\PYG{l+s}{\PYGZdq{}}\PYG{+w}{ }\PYG{n+nb}{w}\PYG{+w}{ }\PYG{n}{l}
\end{sphinxVerbatim}


\section{Fermiエネルギーの変更 (要Update)}
\label{\detokenize{ops:fermi-update}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Fermi energy}} :
Fermiエネルギー(デフォルトでは0)を任意の値にずらします.
(図 \ref{ops:shiftpng}).

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{shift}.png}
\caption{"Shift Fermi energy"メニューで Fermi エネルギーを0.0 Ryから0.1 Ryに変える.}\label{\detokenize{ops:id32}}\label{\detokenize{ops:shiftpng}}\end{figure}


\section{立体視}
\label{\detokenize{ops:id16}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Stereogram}} :
裸眼立体視用の図の表示/非表示を切り替えます(図 \ref{ops:stereogrampng}).
\begin{description}
\sphinxlineitem{None (デフォルト) :}
\sphinxAtStartPar
立体視を無効にします.

\sphinxlineitem{Parallel :}
\sphinxAtStartPar
平行法用の図を表示します.

\sphinxlineitem{Cross :}
\sphinxAtStartPar
交差法用の図を表示します.

\end{description}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{stereogram}.png}
\end{figure}


\section{四面体の切り方 (要Update)}
\label{\detokenize{ops:id17}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Tetraghedron}} :
四面体の切り方を変えます.
図が綺麗になる可能性がありますが,
多くの場合は逆に図がギザギザして汚くなるようです.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=200\sphinxpxdimen]{{tetrahedron}.png}
\end{figure}


\section{サイズ・角度・位置の数値での調整}
\label{\detokenize{ops:id18}}
\sphinxAtStartPar
視点を変更します(図 \ref{ops:setviewpng}).
\begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{Scale}} :}
\sphinxAtStartPar
図形のサイズを指定します.

\sphinxlineitem{\sphinxcode{\sphinxupquote{Position}} :}
\sphinxAtStartPar
図形の上下位置を指定します.

\sphinxlineitem{\sphinxcode{\sphinxupquote{Rotate}} :}
\sphinxAtStartPar
x,y,z軸周りの回転角を指定し, \sphinxcode{\sphinxupquote{Roate}} ボタンを押すと回転する.
回転操作はz軸\sphinxhyphen{}y軸\sphinxhyphen{}x軸の順で行われます.

\end{description}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=300\sphinxpxdimen]{{setview}.png}
\caption{"View point"メニューで 視点を変更する.}\label{\detokenize{ops:id33}}\label{\detokenize{ops:setviewpng}}\end{figure}


\section{矢印}
\label{\detokenize{ops:id19}}
\sphinxAtStartPar
任意の位置に矢印(実際には細長い三角形)を表示する.
以下は全てフラクショナル座標で指定する.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Arrow (Start)}} : 始点

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Arrow (End)}} : 終点

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Arrow (Diff)}} : 上記の差. \sphinxcode{\sphinxupquote{Arrow (End)}} と \sphinxcode{\sphinxupquote{Arrow (Diff)}} は連動する.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Arrow width}} : 矢印(三角形)の幅を指定する.


\section{ワイヤーフレーム球}
\label{\detokenize{ops:id20}}
\sphinxAtStartPar
任意の位置に任意の大きさのワイヤーフレーム球を表示する。
HiLAPWとの関連で使用する.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Sphere center}} : 球の中心をデカルト座標で指定する.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Sphere radius}} : 球の半径を上記と同じスケールで指定する.


\section{ネスティング関数}
\label{\detokenize{ops:id21}}
\sphinxAtStartPar
次の二種類のネスティング関数を計算し, FermiSurferで読み取り可能なファイルを出力する.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{delta*delta}} : ファイル名は「doubledelta.frmsf」
\begin{equation*}
\begin{split}\sum_{n n' \textbf{k}} \delta(\varepsilon_{n \textbf{k}}-\varepsilon_\textrm{F})
\delta(\varepsilon_{n' \textbf{k}+\textbf{q}}-\varepsilon_\textrm{F})\end{split}
\end{equation*}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Lindhard}} :  ファイル名は「lindhard.frmsf」
\begin{equation*}
\begin{split}-\sum_{n n' \textbf{k}} \frac{\theta(\varepsilon_\textrm{F} - \varepsilon_{n' \textbf{k}+\textbf{q}})
-\theta(\varepsilon_\textrm{F}-\varepsilon_{n \textbf{k}})}
{\varepsilon_{n' \textbf{k}+\textbf{q}} - \varepsilon_{n \textbf{k}}}\end{split}
\end{equation*}

\section{画像の保存方法}
\label{\detokenize{ops:id22}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{fermisurfer}} には画像をファイル出力する機能はありません.
お使いのPCにあった方法でスクリーンショットを取得して
(\sphinxcode{\sphinxupquote{Printscreen}} キーを押すなど)
ペイントブラシやgimpで編集して画像を作成してください.

\sphinxstepscope


\chapter{バッチ・モード}
\label{\detokenize{batch:id1}}\label{\detokenize{batch::doc}}
\sphinxAtStartPar
コマンドライン操作のみでFermiSurferで描画した図を画像(PNG)ファイルに保存する,
「バッチ・モード」について説明する.
バッチ・モードを用いると
\sphinxhref{http://fermisurfer.osdn.jp/table.html}{このような沢山の図}
を簡単に作ることができる.

\sphinxAtStartPar
例として、 \sphinxcode{\sphinxupquote{example/}} ディレクトリ内で

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }fermisurfer\PYG{+w}{ }mgb2\PYGZus{}vfz.frmsf\PYG{+w}{ }frmsf.in\PYG{+w}{ }\PYG{l+m}{500}\PYG{+w}{ }\PYG{l+m}{500}
\end{sphinxVerbatim}

\sphinxAtStartPar
を実行すると, 画像ファイル \sphinxcode{\sphinxupquote{frmsf.in.png}} が出力される.
末尾の二つの数字はウィンドウの幅および高さである.
\sphinxcode{\sphinxupquote{frmsf.in}} はバッチ・モード用の描画設定ファイルで,
次のように書かれている.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{backgroundcolor}  \PYG{l+m+mi}{1} \PYG{l+m+mi}{1} \PYG{l+m+mi}{0}
\PYG{n}{linecolor} \PYG{l+m+mi}{0} \PYG{l+m+mi}{0} \PYG{l+m+mi}{1}
         \PYG{n}{band}  \PYG{l+m+mi}{0} \PYG{l+m+mi}{0} \PYG{l+m+mi}{1}
\PYG{c+c1}{\PYGZsh{}brillouinzone  primitive}
     \PYG{n}{colorbar}  \PYG{l+m+mi}{1}
   \PYG{n}{colorscale}  \PYG{n}{fermivelocity}
       \PYG{n}{minmax}  \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{22} \PYG{l+m+mi}{22}
\PYG{c+c1}{\PYGZsh{}      equator  1.0 0.0 0.0}
     \PYG{n}{interpol}  \PYG{l+m+mi}{4}
    \PYG{n}{linewidth}  \PYG{l+m+mf}{3.0}
     \PYG{n}{lighting}  \PYG{n}{both} 
    \PYG{n}{nodalline}  \PYG{l+m+mi}{0}
\PYG{c+c1}{\PYGZsh{}      section  1.0 0.0 0.0}
  \PYG{n}{acrossgamma}  \PYG{l+m+mi}{1}
     \PYG{n}{position}  \PYG{l+m+mf}{0.0} \PYG{l+m+mf}{0.0} \PYG{l+m+mf}{0.0}
        \PYG{n}{scale}  \PYG{l+m+mf}{1.0}
     \PYG{n}{rotation}  \PYG{l+m+mf}{120.0} \PYG{l+m+mf}{40.0} \PYG{l+m+mf}{0.0}
  \PYG{n}{fermienergy}  \PYG{l+m+mf}{0.0}
   \PYG{n}{stereogram}  \PYG{n}{none}
  \PYG{n}{tetrahedron}  \PYG{l+m+mi}{1}
\end{sphinxVerbatim}

\sphinxAtStartPar
これは前節のパネル操作に対応しており,
指定可能なキーワードは次の通りである。
また、指定しなかったキーワードについてはデフォルト値が使われる.


\begin{savenotes}\sphinxattablestart
\sphinxthistablewithglobalstyle
\centering
\begin{tabular}[t]{\X{10}{100}\X{30}{100}\X{30}{100}\X{30}{100}}
\sphinxtoprule
\sphinxstyletheadfamily 
\sphinxAtStartPar
キーワード
&\sphinxstyletheadfamily 
\sphinxAtStartPar
指定可能なパラメーター
&\sphinxstyletheadfamily 
\sphinxAtStartPar
デフォルト値
&\sphinxstyletheadfamily 
\sphinxAtStartPar
説明
\\
\sphinxmidrule
\sphinxtableatstartofbodyhook
\sphinxAtStartPar
background
&
\sphinxAtStartPar
実数 実数 実数
&
\sphinxAtStartPar
0.0 0.0 0.0
&
\sphinxAtStartPar
背景色
\\
\sphinxhline
\sphinxAtStartPar
band
&
\sphinxAtStartPar
1または0をバンド本数分
&
\sphinxAtStartPar
1 1 1 1 ...
&
\sphinxAtStartPar
各バンドの表示(1)または非表示(0)
\\
\sphinxhline
\sphinxAtStartPar
brillouinzone
&
\sphinxAtStartPar
first, primitive
&
\sphinxAtStartPar
first
&
\sphinxAtStartPar
ブリルアンゾーンの種類
\\
\sphinxhline
\sphinxAtStartPar
colorbar
&
\sphinxAtStartPar
0, 1
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
カラーバーの表示(1)または非表示(0)
\\
\sphinxhline
\sphinxAtStartPar
colorscale
&
\sphinxAtStartPar
input1d, input2d, input3d, fermivelocity, bandindex, inputgray, fermivelocitygray
&
\sphinxAtStartPar
input1d
&
\sphinxAtStartPar
カラープロットの種類
\\
\sphinxhline
\sphinxAtStartPar
minmax
&
\sphinxAtStartPar
実数 実数
&
\sphinxAtStartPar
フェルミ面全体の最小値, 最大値
&
\sphinxAtStartPar
カラースケールの範囲
\\
\sphinxhline
\sphinxAtStartPar
equator
&
\sphinxAtStartPar
実数 実数 実数
&
\sphinxAtStartPar
指定しない場合は極軌道を表示しない
&
\sphinxAtStartPar
極軌道の接ベクトル(フラクショナル座標)
\\
\sphinxhline
\sphinxAtStartPar
interpol
&
\sphinxAtStartPar
自然数
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
補間の細かさ
\\
\sphinxhline
\sphinxAtStartPar
linewidth
&
\sphinxAtStartPar
実数
&
\sphinxAtStartPar
1.0
&
\sphinxAtStartPar
線幅
\\
\sphinxhline
\sphinxAtStartPar
lighting
&
\sphinxAtStartPar
both, unoccupied, occupied
&
\sphinxAtStartPar
both
&
\sphinxAtStartPar
どちらの面に照光するか
\\
\sphinxhline
\sphinxAtStartPar
nodalline
&
\sphinxAtStartPar
0, 1
&
\sphinxAtStartPar
0
&
\sphinxAtStartPar
ノーダルラインの表示(1)または非表示(0)
\\
\sphinxhline
\sphinxAtStartPar
section
&
\sphinxAtStartPar
実数 実数 実数
&
\sphinxAtStartPar
指定しない場合は断面を表示しない
&
\sphinxAtStartPar
断面の法線ベクトル(フラクショナル座標)
\\
\sphinxhline
\sphinxAtStartPar
acrossgamma
&
\sphinxAtStartPar
0, 1
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
断面が \({\rm \Gamma}\) 点を通るか(1)否か(0)
\\
\sphinxhline
\sphinxAtStartPar
position
&
\sphinxAtStartPar
実数 実数
&
\sphinxAtStartPar
0.0, 0.0
&
\sphinxAtStartPar
図形の描画位置
\\
\sphinxhline
\sphinxAtStartPar
scale
&
\sphinxAtStartPar
実数
&
\sphinxAtStartPar
1.0
&
\sphinxAtStartPar
図形の拡大率
\\
\sphinxhline
\sphinxAtStartPar
rotation
&
\sphinxAtStartPar
実数 実数 実数
&
\sphinxAtStartPar
0.0, 0.0, 0.0
&
\sphinxAtStartPar
図形のx\sphinxhyphen{}, y\sphinxhyphen{}, z\sphinxhyphen{}軸周りの回転角
\\
\sphinxhline
\sphinxAtStartPar
fermienergy
&
\sphinxAtStartPar
実数
&
\sphinxAtStartPar
0.0
&
\sphinxAtStartPar
Fermiエネルギー
\\
\sphinxhline
\sphinxAtStartPar
stereogram
&
\sphinxAtStartPar
none, parallel, cross
&
\sphinxAtStartPar
none
&
\sphinxAtStartPar
立体視
\\
\sphinxhline
\sphinxAtStartPar
tetrahedron
&
\sphinxAtStartPar
0から15の整数
&
\sphinxAtStartPar
0
&
\sphinxAtStartPar
四面体の切り方
\\
\sphinxbottomrule
\end{tabular}
\sphinxtableafterendhook\par
\sphinxattableend\end{savenotes}

\begin{sphinxadmonition}{note}{注釈:}
\sphinxAtStartPar
この機能は ImageMagic のスクリーンショットを取るコマンド「import」を用いている.
そのためこの機能を使うには ImageMagic がインストールされていなければならない.
\end{sphinxadmonition}

\sphinxstepscope


\chapter{Quantum ESPRESSOを用いたチュートリアル}
\label{\detokenize{qe:quantum-espresso}}\label{\detokenize{qe::doc}}
\sphinxAtStartPar
Quantum ESPRESSO version 6.2 から, FermiSurferで読み込む事が出来るデータ形式での
ファイルを出力出来るようになった.
FermiSurferでプロット出来るのは次の量である.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Fermi速度の絶対値 \(|{\bf v}_{\rm F}|\) (\sphinxcode{\sphinxupquote{fermi\_velocity.x}})

\item {} 
\sphinxAtStartPar
各原子軌道への射影 \(|\langle \phi_{n l m} | \psi_{n k} \rangle|^2\) (\sphinxcode{\sphinxupquote{fermi\_proj.x}})

\end{itemize}


\section{\sphinxstyleliteralintitle{\sphinxupquote{PostProcess}} ツールのビルド}
\label{\detokenize{qe:postprocess}}
\sphinxAtStartPar
上記の量をFermiSurferで描画するためには, 次のようにしてQuantumESPRESSO内の \sphinxcode{\sphinxupquote{PostProcess}} ツール
(バンド図や電子密度をプロットするためのツール群)をビルドする必要がある.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }make\PYG{+w}{ }pp
\end{sphinxVerbatim}


\section{SCF計算}
\label{\detokenize{qe:scf}}
\sphinxAtStartPar
ここからチュートリアルに入る.
まず初めに \sphinxcode{\sphinxupquote{pw.x}} プログラムを用いて電子状態計算をおこなう.
MgB$_{\text{2}}$を題材として扱う.
入力ファイルは次の通りである.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{scf.in}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZam{}}\PYG{n}{CONTROL}
 \PYG{n}{calculation} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{scf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
  \PYG{n}{pseudo\PYGZus{}dir} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{prefix} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mgb2}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{,}
      \PYG{n}{outdir} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{o}{/}
\PYG{o}{\PYGZam{}}\PYG{n}{SYSTEM}
       \PYG{n}{ibrav} \PYG{o}{=} \PYG{l+m+mi}{4}\PYG{p}{,}
   \PYG{n}{celldm}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{o}{=} \PYG{l+m+mf}{5.808563789}\PYG{p}{,}
   \PYG{n}{celldm}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)} \PYG{o}{=} \PYG{l+m+mf}{1.145173082}\PYG{p}{,}
         \PYG{n}{nat} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{,}
        \PYG{n}{ntyp} \PYG{o}{=} \PYG{l+m+mi}{2}\PYG{p}{,}
     \PYG{n}{ecutwfc} \PYG{o}{=} \PYG{l+m+mf}{50.0} \PYG{p}{,}
     \PYG{n}{ecutrho} \PYG{o}{=} \PYG{l+m+mf}{500.0} \PYG{p}{,}
 \PYG{n}{occupations} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tetrahedra\PYGZus{}opt}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
\PYG{o}{/}
\PYG{o}{\PYGZam{}}\PYG{n}{ELECTRONS}
\PYG{o}{/}
\PYG{n}{ATOMIC\PYGZus{}SPECIES}
 \PYG{n}{Mg}    \PYG{l+m+mf}{24.3050}   \PYG{n}{Mg}\PYG{o}{.}\PYG{n}{pbe}\PYG{o}{\PYGZhy{}}\PYG{n}{n}\PYG{o}{\PYGZhy{}}\PYG{n}{kjpaw\PYGZus{}psl}\PYG{l+m+mf}{.0}\PYG{l+m+mf}{.3}\PYG{l+m+mf}{.0}\PYG{o}{.}\PYG{n}{upf}
  \PYG{n}{B}    \PYG{l+m+mf}{10.811}    \PYG{n}{B}\PYG{o}{.}\PYG{n}{pbe}\PYG{o}{\PYGZhy{}}\PYG{n}{n}\PYG{o}{\PYGZhy{}}\PYG{n}{kjpaw\PYGZus{}psl}\PYG{l+m+mf}{.0}\PYG{l+m+mf}{.1}\PYG{o}{.}\PYG{n}{upf}
\PYG{n}{ATOMIC\PYGZus{}POSITIONS} \PYG{n}{crystal}
 \PYG{n}{Mg}    \PYG{l+m+mf}{0.000000000}    \PYG{l+m+mf}{0.000000000}    \PYG{l+m+mf}{0.000000000}    
  \PYG{n}{B}    \PYG{l+m+mf}{0.333333333}    \PYG{l+m+mf}{0.666666667}    \PYG{l+m+mf}{0.500000000}    
  \PYG{n}{B}    \PYG{l+m+mf}{0.666666667}    \PYG{l+m+mf}{0.333333333}    \PYG{l+m+mf}{0.500000000}    
\PYG{n}{K\PYGZus{}POINTS} \PYG{n}{automatic} 
\PYG{l+m+mi}{16} \PYG{l+m+mi}{16} \PYG{l+m+mi}{12} \PYG{l+m+mi}{0} \PYG{l+m+mi}{0} \PYG{l+m+mi}{0}
\end{sphinxVerbatim}

\sphinxAtStartPar
この計算で使われている擬ポテンシャルファイルは
\sphinxhref{http://theossrv1.epfl.ch/Main/Pseudopotentials}{PS Library} に含まれているものであり,
以下のアドレスからダウンロードできる.
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxurl{http://theossrv1.epfl.ch/uploads/Main/NoBackup/Mg.pbe-n-kjpaw\_psl.0.3.0.upf}

\item {} 
\sphinxAtStartPar
\sphinxurl{http://theossrv1.epfl.ch/uploads/Main/NoBackup/B.pbe-n-kjpaw\_psl.0.1.upf}

\end{itemize}

\sphinxAtStartPar
入力ファイルと擬ポテンシャルファイルを同じディレクトリに置き,
そのディレクトリで \sphinxcode{\sphinxupquote{pw.x}} を実行する.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }mpiexec\PYG{+w}{ }\PYGZhy{}np\PYG{+w}{ }\PYG{l+m}{4}\PYG{+w}{ }pw.x\PYG{+w}{ }\PYGZhy{}npool\PYG{+w}{ }\PYG{l+m}{4}\PYG{+w}{ }\PYGZhy{}in\PYG{+w}{ }scf.in
\end{sphinxVerbatim}

\sphinxAtStartPar
プロセス数, \sphinxstyleemphasis{k} 点並列数(\sphinxcode{\sphinxupquote{npool}})は自由.
お好みで, 異なる \sphinxstyleemphasis{k} グリッドでNon\sphinxhyphen{}scf計算を行っても良い.


\section{Fermi速度の計算と描画}
\label{\detokenize{qe:fermi}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{fermi\_velocity.x}} プログラムを実行する.
入力ファイルは \sphinxcode{\sphinxupquote{pw.x}} のものと同一である.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }mpiexec\PYG{+w}{ }\PYGZhy{}np\PYG{+w}{ }\PYG{l+m}{1}\PYG{+w}{ }fermi\PYGZus{}velocity.x\PYG{+w}{ }\PYGZhy{}npool\PYG{+w}{ }\PYG{l+m}{1}\PYG{+w}{ }\PYGZhy{}in\PYG{+w}{ }scf.in
\end{sphinxVerbatim}

\sphinxAtStartPar
このとき, \sphinxstyleemphasis{k} 点並列数(\sphinxcode{\sphinxupquote{npool}})は1(もしくは指定しない)でなければならない.
これにより, Fermi速度のファイル \sphinxcode{\sphinxupquote{vfermi.frmsf}} が作られるので,
それをFermiSurferで読み込む.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }fermisurfer\PYG{+w}{ }vfermi.frmsf
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.300\linewidth]{{qe_vf}.png}
\end{figure}

\sphinxAtStartPar
なお, コリニアスピン計算では各スピンについてそれぞれ \sphinxcode{\sphinxupquote{vfermi1.frmsf}}, \sphinxcode{\sphinxupquote{vfermi2.frmsf}}
の2つのファイルが出力される.


\section{原子軌道射影の計算と描画}
\label{\detokenize{qe:id1}}
\sphinxAtStartPar
原子軌道射影の描画では, まず部分状態密度等を計算するプログラム
\sphinxcode{\sphinxupquote{projwfc.x}} を実行する.
入力ファイルは次の通りである.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{proj.in}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZam{}}\PYG{n}{PROJWFC}
   \PYG{n}{outdir} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{prefix}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mgb2}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{Emin}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.3422}\PYG{p}{,} 
    \PYG{n}{Emax}\PYG{o}{=}\PYG{l+m+mf}{10.0578}\PYG{p}{,} 
    \PYG{n}{DeltaE}\PYG{o}{=}\PYG{l+m+mf}{0.1}
\PYG{o}{/}
\PYG{l+m+mi}{2}
\PYG{l+m+mi}{6} \PYG{l+m+mi}{10}
\end{sphinxVerbatim}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PROJWFC}} ネームリストの終わり(\sphinxcode{\sphinxupquote{/}})以降は \sphinxcode{\sphinxupquote{projwfc.x}} では使われず,
後で \sphinxcode{\sphinxupquote{fermi\_proj.x}} を実行するときのみ使われる.
\sphinxcode{\sphinxupquote{projwfc.x}} を実行するときのプロセス数, \sphinxstyleemphasis{k} 点並列数(\sphinxcode{\sphinxupquote{npool}})は
直前の \sphinxcode{\sphinxupquote{pw.x}} の実行時と同じ値にしなければならない.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }mpiexec\PYG{+w}{ }\PYGZhy{}np\PYG{+w}{ }\PYG{l+m}{4}\PYG{+w}{ }projwfc.x\PYG{+w}{ }\PYGZhy{}npool\PYG{+w}{ }\PYG{l+m}{4}\PYG{+w}{ }\PYGZhy{}in\PYG{+w}{ }proj.in
\end{sphinxVerbatim}

\sphinxAtStartPar
ただし, \sphinxcode{\sphinxupquote{wf\_collect=.true.}} としていたときは除く.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{projwfc.x}} の標準出力のはじめの方に次のような箇所がある.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Atomic} \PYG{n}{states} \PYG{n}{used} \PYG{k}{for} \PYG{n}{projection}
\PYG{p}{(}\PYG{n}{read} \PYG{k+kn}{from} \PYG{n+nn}{pseudopotential} \PYG{n}{files}\PYG{p}{)}\PYG{p}{:}

\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   1: atom   1 (Mg ), wfc  1 (l=0 m= 1)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   2: atom   1 (Mg ), wfc  2 (l=1 m= 1)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   3: atom   1 (Mg ), wfc  2 (l=1 m= 2)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   4: atom   1 (Mg ), wfc  2 (l=1 m= 3)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   5: atom   2 (B  ), wfc  1 (l=0 m= 1)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   6: atom   2 (B  ), wfc  2 (l=1 m= 1)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   7: atom   2 (B  ), wfc  2 (l=1 m= 2)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   8: atom   2 (B  ), wfc  2 (l=1 m= 3)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}   9: atom   3 (B  ), wfc  1 (l=0 m= 1)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}  10: atom   3 (B  ), wfc  2 (l=1 m= 1)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}  11: atom   3 (B  ), wfc  2 (l=1 m= 2)}
\PYG{n}{state} \PYG{c+c1}{\PYGZsh{}  12: atom   3 (B  ), wfc  2 (l=1 m= 3)}
\end{sphinxVerbatim}

\sphinxAtStartPar
これは各原子軌道の番号(\sphinxcode{\sphinxupquote{state \#}})とその中身
(詳しくはQEに付属の \sphinxcode{\sphinxupquote{INPUT\_PROJWFC.html}} 等を参照)を表している.
この後でFermi面上で描画する原子軌道射影を選ぶ時にはこの番号を用いる.
具体的な例を示す. 上記の \sphinxcode{\sphinxupquote{proj.in}} を用いて

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }mpiexec\PYG{+w}{ }\PYGZhy{}np\PYG{+w}{ }\PYG{l+m}{1}\PYG{+w}{ }fermi\PYGZus{}proj.x\PYG{+w}{ }\PYGZhy{}npool\PYG{+w}{ }\PYG{l+m}{1}\PYG{+w}{ }\PYGZhy{}in\PYG{+w}{ }proj.in
\end{sphinxVerbatim}

\sphinxAtStartPar
のように実行してFermiSurfer用ファイル \sphinxcode{\sphinxupquote{proj.frmsf}} を得るのだが,
このとき \sphinxcode{\sphinxupquote{proj.in}} の \sphinxcode{\sphinxupquote{/}} 以降

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{l+m+mi}{2}
\PYG{l+m+mi}{6} \PYG{l+m+mi}{10}
\end{sphinxVerbatim}

\sphinxAtStartPar
では, 最初の数字 (\sphinxcode{\sphinxupquote{2}}) が足し合わされる原子軌道射影の総数を表し,
その後に足し合わされる原子軌道射影に対応する番号が列挙される.
この場合は1番目のB原子の2pz軌道(\sphinxcode{\sphinxupquote{6}})と2番目のB原子の2pz軌道(\sphinxcode{\sphinxupquote{10}})
を足したもの
\begin{equation*}
\begin{split}|\langle \phi_{B_1 2pz} | \psi_{nk} \rangle|^2
+ |\langle \phi_{B_2 2pz} | \psi_{nk} \rangle|^2\end{split}
\end{equation*}
\sphinxAtStartPar
が出力される.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }fermisurfer\PYG{+w}{ }proj.frmsf
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.300\linewidth]{{qe_proj_pz}.png}
\end{figure}

\sphinxAtStartPar
また例えば, すべてのB原子の2px, 2py軌道からの寄与を合わせたものをプロットしたい場合には,

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZam{}}\PYG{n}{PROJWFC}
\PYG{n}{outdir} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{./}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{prefix}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mgb2}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{Emin}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.3422}\PYG{p}{,}
\PYG{n}{Emax}\PYG{o}{=}\PYG{l+m+mf}{10.0578}\PYG{p}{,}
\PYG{n}{DeltaE}\PYG{o}{=}\PYG{l+m+mf}{0.1}
\PYG{o}{/}
\PYG{l+m+mi}{4}
\PYG{l+m+mi}{7} \PYG{l+m+mi}{8} \PYG{l+m+mi}{11} \PYG{l+m+mi}{12}
\end{sphinxVerbatim}

\sphinxAtStartPar
のように \sphinxcode{\sphinxupquote{proj.in}} を書き換えて, \sphinxcode{\sphinxupquote{fermi\_proj.x}} をもう一度実行すれば良い.
\sphinxcode{\sphinxupquote{projwfc.x}} を再度実行する必要は無い.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.300\linewidth]{{qe_proj_pxy}.png}
\end{figure}

\sphinxstepscope


\chapter{FermiSurfer on Web}
\label{\detokenize{onweb:fermisurfer-on-web}}\label{\detokenize{onweb::doc}}
\sphinxAtStartPar
下記のページにアクセスするとWebブラウザー上でFermiSurferを使うことができます。
\sphinxurl{https://fermisurfer.osdn.jp/js/index.php}


\section{操作方法}
\label{\detokenize{onweb:id1}}
\sphinxAtStartPar
{\hyperref[\detokenize{ops:ops}]{\sphinxcrossref{\DUrole{std,std-ref}{アプリ版FermiSurferの機能}}}} と同等を目指していますが、一部の機能はまだサポートされていません。


\section{ファイル入力}
\label{\detokenize{onweb:id2}}
\sphinxAtStartPar
画面左上のファイル選択ボタンでローカルのFRMSFファイル(BXSFファイルはサポートしていません)
を選択するとフェルミ面が表示されます。
表示されるまでややタイムラグが生じる場合があります。


\section{Web上のファイルを開く}
\label{\detokenize{onweb:web}}
\sphinxAtStartPar
以下のようにURLに引数をつけることにより、Web上で公開されているフェルミ面の入力ファイルを、リンクをクリックするだけで開くことができます。

\sphinxAtStartPar
\sphinxurl{https://fermisurfer.osdn.jp/js/index.php?frmsf=https://fermisurfer.osdn.jp/js/Pb.js}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{https://fermisurfer.osdn.jp/js/index.php?frmsf=}} に続けてファイルの保存先のURLを付け足します。
これは研究紹介やプレスリリースのページで使うとよいでしょう。

\sphinxAtStartPar
このときの入力ファイル \sphinxcode{\sphinxupquote{Pb.js}} は、

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{frmsf}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}16 16 16 1 2 \PYGZhy{}0.67303315756516724 0.67303315756516724 ... \PYGZdq{}}\PYG{p}{;}
\end{sphinxVerbatim}

\sphinxAtStartPar
のように、 {\hyperref[\detokenize{input:input}]{\sphinxcrossref{\DUrole{std,std-ref}{FRMSF形式}}}} のファイルの改行をスペースに置き換えて1行の文字列にしたものを
\sphinxcode{\sphinxupquote{frmsf}} という変数に代入するjavascriptソースになっています。
BXSF形式には対応していません。

\sphinxAtStartPar
FRMSF形式のファイルを上記の形式に変換するにはコマンドラインで

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sed\PYG{+w}{ }\PYGZhy{}e\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}1i frmsf=\PYGZdq{}\PYGZsq{}}\PYG{+w}{ }\PYGZhy{}e\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}\PYGZdl{}a \PYGZdq{};\PYGZsq{}}\PYG{+w}{ }ANY.frmsf\PYG{+w}{ }\PYG{p}{|}\PYG{+w}{ }perl\PYG{+w}{ }\PYGZhy{}pe\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}s/\PYGZbs{}n/ /g\PYGZsq{}}\PYG{+w}{ }\PYG{p}{|}\PYG{+w}{ }sed\PYG{+w}{ }\PYGZhy{}E\PYG{+w}{ }\PYGZhy{}e\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}s/ +/ /g\PYGZsq{}}\PYG{+w}{ }\PYGZhy{}e\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}s/\PYGZdq{} /\PYGZdq{}/g\PYGZsq{}}\PYG{+w}{ }\PYGZhy{}e\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}s/ \PYGZdq{}/\PYGZdq{}/g\PYGZsq{}}\PYG{+w}{ }\PYGZgt{}\PYG{+w}{ }ANY.js
\end{sphinxVerbatim}

\sphinxAtStartPar
とします。
これと同じ処理を行うシェルスクリプトファイルがこちらにあります。

\sphinxAtStartPar
\sphinxurl{https://fermisurfer.osdn.jp/js/frmsf2js.sh}

\sphinxAtStartPar
使い方は下記のとおりです。 \sphinxcode{\sphinxupquote{ANY.js}} (ANYの部分は任意) というファイルが生成されるので、それをWebサーバーに配置します。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{}\PYG{+w}{ }bash\PYG{+w}{ }frmsf2js.sh\PYG{+w}{ }ANY.frmsf
\end{sphinxVerbatim}

\sphinxstepscope


\chapter{謝辞}
\label{\detokenize{ack:id1}}\label{\detokenize{ack::doc}}
\sphinxAtStartPar
東京大学物性研究所 小西優祐氏には, Mac
OSXでの動作チェックおよびMakefile,
パッチの提供をしていただいたことに感謝する.

\sphinxstepscope


\chapter{プログラムの再配布}
\label{\detokenize{copy:id1}}\label{\detokenize{copy::doc}}

\section{自分のプログラムにFermiSurferを含める}
\label{\detokenize{copy:fermisurfer}}
\sphinxAtStartPar
FermiSurferは下記の {\hyperref[\detokenize{copy:mitlicense}]{\sphinxcrossref{\DUrole{std,std-ref}{MIT ライセンス}}}} に基づいて配布されている.
これはかいつまんで言うと,
個人的(研究室や共同研究者等のグループ)なプログラムであろうとも,
公開したり売ったりするプログラムであろうとも
自由にコピペしたり改変して良いし,
どのようなライセンスで配布しても構わない, と言うことである.


\section{MIT ライセンス}
\label{\detokenize{copy:mit}}\label{\detokenize{copy:mitlicense}}
\begin{DUlineblock}{0em}
\item[] Copyright (c) 2014 Mitsuaki Kawamura
\item[] 
\item[] 以下に定める条件に従い,
\item[] 本ソフトウェアおよび関連文書のファイル（以下「ソフトウェア」）
\item[] の複製を取得するすべての人に対し,
\item[] ソフトウェアを無制限に扱うことを無償で許可します. これには,
\item[] ソフトウェアの複製を使用, 複写, 変更, 結合, 掲載, 頒布, サブライセンス,
\item[] および/または販売する権利,
\item[] およびソフトウェアを提供する相手に同じことを許可する権利も無制限に含まれます.
\item[] 
\item[] 上記の著作権表示および本許諾表示を,
\item[] ソフトウェアのすべての複製または重要な部分に記載するものとします.
\item[] 
\item[] ソフトウェアは「現状のまま」で, 明示であるか暗黙であるかを問わず,
\item[] 何らの保証もなく提供されます. ここでいう保証とは, 商品性,
\item[] 特定の目的への適合性, および権利非侵害についての保証も含みますが,
\item[] それに限定されるものではありません. 作者または著作権者は, 契約行為,
\item[] 不法行為, またはそれ以外であろうと, ソフトウェアに起因または関連し,
\item[] あるいはソフトウェアの使用またはその他の扱いによって生じる一切の請求,
\item[] 損害, その他の義務について何らの責任も負わないものとします.
\end{DUlineblock}

\sphinxstepscope


\chapter{問い合わせ先}
\label{\detokenize{contact:id1}}\label{\detokenize{contact::doc}}
\sphinxAtStartPar
プログラムのバグや質問は以下のフォーラムへご投稿ください.

\sphinxAtStartPar
\sphinxurl{https://github.com/mitsuaki1987/fermisurfer/issues}

\sphinxAtStartPar
開発に参加したい方は以下の連絡先にて受け付けております.

\sphinxAtStartPar
東京大学物性研究所

\sphinxAtStartPar
河村光晶

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{mkawamura\_\_at\_\_ds.itc.u\sphinxhyphen{}tokyo.ac.jp}}



\renewcommand{\indexname}{索引}
\printindex
\end{document}